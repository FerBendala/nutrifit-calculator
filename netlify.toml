[build]
  command = "npm run build"
  publish = "out"

# ===================================
# EXCEPCIONES: Archivos que NO deben tener trailing slash
# Estas reglas DEBEN ir ANTES del redirect global
# ===================================

[[redirects]]
  from = "/sitemap.xml"
  to = "/sitemap.xml"
  status = 200

[[redirects]]
  from = "/robots.txt"
  to = "/robots.txt"
  status = 200

[[redirects]]
  from = "/favicon.ico"
  to = "/favicon.ico"
  status = 200

[[redirects]]
  from = "/ads.txt"
  to = "/ads.txt"
  status = 200

[[redirects]]
  from = "/calculator-icon.svg"
  to = "/calculator-icon.svg"
  status = 200

[[redirects]]
  from = "/icon.svg"
  to = "/icon.svg"
  status = 200

[[redirects]]
  from = "/index.txt"
  to = "/index.txt"
  status = 200

# Excepciones preventivas para archivos futuros comunes
[[redirects]]
  from = "/manifest.webmanifest"
  to = "/manifest.webmanifest"
  status = 200

[[redirects]]
  from = "/site.webmanifest"
  to = "/site.webmanifest"
  status = 200

[[redirects]]
  from = "/apple-touch-icon.png"
  to = "/apple-touch-icon.png"
  status = 200

[[redirects]]
  from = "/feed.xml"
  to = "/feed.xml"
  status = 200

[[redirects]]
  from = "/rss.xml"
  to = "/rss.xml"
  status = 200

[[redirects]]
  from = "/llms.txt"
  to = "/llms.txt"
  status = 200

# Excepción para .well-known (verificaciones de dominio, ACME, security.txt, etc.)
[[redirects]]
  from = "/.well-known/*"
  to = "/.well-known/:splat"
  status = 200

# ===================================
# REDIRECTS ESPECÍFICOS
# ===================================

[[redirects]]
  from = "/home"
  to = "/"
  status = 301

[[redirects]]
  from = "/index.html"
  to = "/"
  status = 301
  force = true

# ===================================
# REDIRECT GLOBAL: Trailing Slash (con force=false)
# DEBE IR AL FINAL
# ===================================

[[redirects]]
  from = "/:path"
  to = "/:path/"
  status = 301
  force = false

# ===================================
# HEADERS: Assets (Cache largo)
# ===================================

[[headers]]
  for = "/_next/static/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.jpg"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.jpeg"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.png"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.gif"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.svg"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.webp"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.ico"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.avif"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.css"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.js"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.woff"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.woff2"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.ttf"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.eot"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

# ===================================
# HEADERS: HTML (Cache corto)
# ===================================

[[headers]]
  for = "/*.html"
  [headers.values]
    Cache-Control = "public, max-age=300, s-maxage=600"
    X-Content-Type-Options = "nosniff"
    X-Frame-Options = "DENY"
    X-XSS-Protection = "1; mode=block"

# ===================================
# HEADERS: XML y TXT (Cache medio)
# ===================================

[[headers]]
  for = "/sitemap.xml"
  [headers.values]
    Content-Type = "application/xml"
    Cache-Control = "public, max-age=3600, s-maxage=7200"

[[headers]]
  for = "/robots.txt"
  [headers.values]
    Content-Type = "text/plain"
    Cache-Control = "public, max-age=3600, s-maxage=7200"

# ===================================
# HEADERS: Todo lo demás (Cache bajo + seguridad)
# ===================================

[[headers]]
  for = "/*"
  [headers.values]
    X-Content-Type-Options = "nosniff"
    X-Frame-Options = "DENY"
    X-XSS-Protection = "1; mode=block"
